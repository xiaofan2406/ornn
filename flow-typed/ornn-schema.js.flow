export type FunctionDefault = () => mixed;

export type ValueDefault = string | number | void;

export type Default = FunctionDefault | ValueDefault;

export type PropertyConfig = {|
  type: string, // TODO types enum?
  /*
    db: NOT NULL
  */
  required?: boolean,
  /*
    db: DEFAULT
  */
  default?: Default,
  /*
    db: PRIMARY KEY
  */
  primaryKey?: boolean,
  /*
    db: UNIQUE
  */
  unique?: boolean,
  /*
    db: GENERATED BY DEFAULT AS IDENTITY
  */
  identity?: boolean,
  /*
    getError? return error message, falsy value means valid
  */
  validate?: (data: Object) => string,
|};

export type SchemaConfig = {
  [string]: PropertyConfig,
};

export type SchemaOption = {|
  tableName: string,
  /*
    add serial id primary key
  */
  defaultId?: boolean,
  /*
    add generates createdAt and updatedAt
  */
  timestamp?: boolean,
|};

declare module '@ornn/schema' {
  declare class Schema {
    constructor(config: SchemaConfig, options: SchemaOption): Schema;

    +properties: string[];

    getValues(data: Object): Object;

    describeTable(): string;
  }

  // TODO enum
  declare export var PG_TYPES: { [string]: string };

  declare export default typeof Schema;
}
